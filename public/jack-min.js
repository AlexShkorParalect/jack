(function(){function n(e){var i;e=e.substr(4,e.length-7);i=e.match(/\n([ \t]*)$/)[1];e=e.substr(0,e.length-i.length-1);return e.split("\n").map(function(j){return j.substr(i.length)}).join("\n")}function f(e){for(var i=[],j=0,b=0,m;;){b=e.substr(j).search(p);if(b<0){j<e.length&&i.push(e.substr(j));break}i.push(e.substr(j,b));j+=b;m=e.substr(j).match(p);b=m[0].length;if(b<0)break;i.push(m[1]||m[2]);j+=b}return i}function g(e){var i,j;return e.map(function(b){var m,l;i=j;l=b.value;j=b.name;switch(j){case "NEWLINE":if(i===
"NEWLINE")return false;break;case "WS":return false;case "CODE":b.name=b.value;delete b.value;break;case "STRING":b.value=JSON.parse(l);break;case "STRING_HEREDOC":b.name="STRING";b.value=n(l);break;case "INTERPOL":case "INTERPOL_HEREDOC":m=l.indexOf('"');if(m>0){b.type=l.substr(0,m);l=l.substr(m)}if(j==="INTERPOL_HEREDOC"){b.name="INTERPOL";b.value=f(n(l))}else b.value=f(JSON.parse(l));break;case "COMMENT":b.value=l.substr(1);break;case "ID":if((m=c.indexOf(l))>=0){b.name="BOOLEAN";b.value=m%2===
0}if(h.indexOf(l)>=0){b.name=l;delete b.value}break;case "NUMBER":b.value=l.indexOf(".")>=0?parseFloat(l):l.match(/x/i)?l.toLowerCase():parseInt(l,10);break}return b}).filter(function(b){return b})}function k(e){var i,j,b;for(b in o)if(o.hasOwnProperty(b))if((i=o[b](e))&&(!j||i[1].length>j.value.length))j={name:b,value:i[1]};return j}function a(e){for(var i=0,j=e.length,b=[],m;i<j;){m=k(e.substr(i));if(!m){e=e.substr(0,i).split("\n").length;throw new Error("Lexer error on line "+e+". Unrecognized input\n"+
(i+1));}b.push({name:m.name,value:m.value,offset:i,lineno:e.substr(0,i).split("\n").length});i+=m.value.length}return g(b)}var d=typeof exports!=="undefined"&&exports||this;d=d.Jack||(d.Jack={});var c,h,o,p;c=["true","false","on","off","yes","no"];h=["fun","return"];o={ID:/^([a-z_$][a-z0-9_$]*)\b/i,WS:/^([ \t]+)/,COMMENT:/^(#.*)\n/,NEWLINE:/^([ \t]*\n)/,NUMBER:/^(0x[0-9a-f]+|-?(0|[1-9][0-9]*)(\.[0-9]+)?(e[+\-]?[0-9]+)?)\b/i,STRING:/^('(\\.|[^'])*')/,INTERPOL:/^(([a-z$_][a-z0-9$_]*)?"(\/.|[^"])*")/i,
STRING_HEREDOC:/^('''\n(?:[^']|'[^']|''[^']|\\')*\n[ \t]*''')/,INTERPOL_HEREDOC:/^(([a-z$_][a-z0-9$_]*)?"""\n(?:[^"]|"[^"]|""[^"]|\\")*\n[ \t]*""")/i,REGEX:/^(\/(?:\\\/|[^\/])*\/[img]*)/,CODE:/^([\[\]\{\},=])/,OPERATOR:/^([*\/+\-])/,ARROW:/^(->)/};p=/\$(?:([a-z$_][a-z0-9$_]*)|\{([^}]*)\})/i;d.tokenize=a})();
(function(){var n=typeof exports!=="undefined"&&exports||this;n=n.Jack||(n.Jack={});var f=f||require("jison").Parser,g,k,a,d;g={Root:[["Block","return $$ = {name: 'Block', value: $1}"]],Block:[["Statement","$$ = $1"],["Block Statement","$$ = $1.concat($2)"]],Statement:[["COMMENT NEWLINE","$$ = []"],["Expression NEWLINE","$$ = [$1]"]],Expression:[["STRING","$$ = yytext"],["BOOLEAN","$$ = yytext"],["NUMBER","$$ = yytext"],["REGEX","$$ = yytext"],["INTERPOL","$$ = yytext"],["Id","$$ = $1"],["List","$$ = $1"],
["Object","$$ = $1"],["Function","$$ = $1"]],Id:[["ID","$$ = yytext"]],List:[["[ ListItems ]","$$ = {name: 'List', value: $2}"],["[ NEWLINE ListBlock NEWLINE ]","$$ = {name: 'List', value: $3}"],["[ Id ListItems ]","$$ = {name: 'List', parent: $2, value: $3}"],["[ Id NEWLINE ListBlock NEWLINE ]","$$ = {name: 'List', parent: $2, value: $4}"]],ListBlock:[["ListItems","$$ = $1"],["ListBlock NEWLINE ListItems","$$ = $1.concat($3)"]],ListItems:[["Expression","$$ = [$1]"],["ListItems , Expression","$$ = $1.concat([$3])"]],
Object:[["{ ObjectItems }","$$ = {name: 'Object', value: $2}"],["{ NEWLINE ObjectBlock NEWLINE }","$$ = {name: 'Object', value: $3}"],["{ Id ObjectItems }","$$ = {name: 'Object', parent: $2, value: $3}"],["{ Id NEWLINE ObjectBlock NEWLINE }","$$ = {name: 'Object', parent: $2, value: $4}"]],ObjectBlock:[["ObjectItems","$$ = $1"],["ObjectBlock NEWLINE ObjectItems","$$ = $1.concat($3)"]],ObjectItems:[["ObjectItem","$$ = [$1]"],["ObjectItems ObjectItem","$$ = $1.concat([$2])"]],ObjectItem:[["Id = Expression",
"$$ = [$1, $3]"]],Function:[["fun Abstractions Expression","$$ = {name: 'Function', value: [$2, $3]}"]],Abstractions:[["Id ARROW","$$ = [[$1]]"],["Abstractions Id ARROW","$$ = $1.concat([[$2]])"]],Args:[["Id","$$ = [$1]"],["Args , Id","$$ = $1.concat([$3])"]]};k=[];for(d in g)g.hasOwnProperty(d)&&g[d].forEach(function(c){c[0].split(" ").forEach(function(h){!g[h]&&k.indexOf(h)<0&&k.push(h)})});a=new f({bnf:g,tokens:k.join(" ")});a.lexer={lex:function(){var c=this.tokens[this.pos];if(!c){this.yylineno=
"END";return""}this.pos+=1;this.yylineno=c.lineno-1;this.yytext=c;return c.name},setInput:function(c){this.tokens=c;this.pos=0},upcomingInput:function(){return""},showPosition:function(){return this.pos}};n.parse=function(){return a.parse.apply(a,arguments)}})();process.mixin(require("sys"));
(function(){function n(a){return"\n"+a.split("\n").map(function(d){return"  "+d}).join("\n")+"\n"}function f(a){if(!a)return"";if(k[a.name])return k[a.name](a);if(typeof a.name=="string"&&a.name.match(/^[A-Z]+$/))return a.value;return JSON.stringify(a)}var g=typeof exports!=="undefined"&&exports||this;g=g.Jack||(g.Jack={});var k;k={Block:function(a){return a.value.map(f).join("\n")},BOOLEAN:function(a){return a.value?"true":"false"},STRING:function(a){return JSON.stringify(a.value)},List:function(a){var d;
if(!a.parent)return"["+a.value.map(f).join(", ")+"]";d=a.value.map(function(c,h){return h+": {value: "+f(c)+", enumerable: true}"});d.push("length: {value: "+a.value.length+", enumerable: false}");return"Object.create("+f(a.parent)+", {"+d.join(", ")+"})"},Object:function(a){if(!a.parent)return"{"+a.value.map(function(d){return f(d[0])+": "+f(d[1])}).join(", ")+"}";return"Object.create("+f(a.parent)+", {"+a.value.map(function(d){return f(d[0])+": {value: "+f(d[1])+", enumerable: true}"}).join(", ")+
"})"},Function:function(a){var d=a.value[0],c=a.value[1],h;if(d.length>1){c={name:a.name,value:[d.slice(1),c]};d.length=1;h=true}d=d.map(function(o){return o.map(f).join(", ")});c="return "+f(c)+";";c=h?n(c):" "+c+" ";return"function ("+d.join("")+") {"+c+"}"},INTERPOL:function(a){var d=false,c;c=a.value.map(function(h){if(d=!d)return JSON.stringify(h);return h});if(a.type)return a.type+".interpolate(["+c.join(", ")+"])";c=c.filter(function(h){return h!=='""'});if(c.length===0)return'""';if(c.length===
1)return c[0];return"("+c.join(" + ")+")"}};g.generate=function(a){return f(a)}})();
(function(){var n=typeof exports!=="undefined"&&exports||this,f=n.Jack||(n.Jack={});f.tokenize||(f.tokenize=require("jack/lexer").Jack.tokenize);f.parse||(f.parse=require("jack/grammar").Jack.parse);f.generate||(f.generate=require("jack/generator").Jack.generate);f.compile=function(g){var k,a,d;try{k=f.tokenize(g);a=f.parse(k);return d=f.generate(a)}catch(c){var h,o,p;a=c.message.split("\n");h=parseInt(a[1])-1;a=a[0];if(k){if(o=k[h]){d=g.substr(0,o.offset).match(/\n?.*$/)[0];p=g.substr(o.offset,g.length).match(/^.*\n?/)[0];
g=k.slice(0,h).filter(function(e){return e.lineno==o.lineno}).map(function(e){return e.name});k=k.slice(h).filter(function(e){return e.lineno==o.lineno}).map(function(e){return e.name});c.message=a+" but found '"+o.name+"'\nLine "+o.lineno+": "+JSON.stringify(d)+" !! "+JSON.stringify(p)+"'\nTokens "+JSON.stringify(g)+" !! "+JSON.stringify(k)}}else{d=g.substr(0,h).match(/\n?.*$/)[0];p=g.substr(h,g.length).match(/^.*\n?/)[0];line_no=g.substr(0,h).split("\n").length;c.message=a+"\nLine "+line_no+": "+
JSON.stringify(d)+" !! "+JSON.stringify(p)}throw c;}}})();var file=require("file");process.mixin(require("sys"));file.read("../test.jack").addCallback(function(n){n=exports.Jack.compile(n);puts("\nJS:\n"+n)});
